/*************************************************
Canvas Mask Utility v0.1
Authors: www.benbarnett.net || @benpbarnett
         www.xurei-design.be || @xurei

Copyright (c) 2012 Ben Barnett - Olivier Bourdoux
Licensed under the MIT license
http://www.opensource.org/licenses/mit-license.php
**************************************************/
function applyCanvasMask(a,b,c,d,e,f,g){if(!document.createElement("canvas").getContext)return a;var h=document.createElement("canvas"),i=h.getContext("2d"),j=document.createElement("canvas"),k=j.getContext("2d"),l=null,m=null,n=null;h.width=e,h.height=f*2,j.width=e,j.height=f,i.drawImage(a,0,0),i.drawImage(b,0,f),l=i.getImageData(0,0,e,f),m=l.data,n=i.getImageData(0,f,e,f).data;var o=s*e+t;len=m.length;for(var p=3;p<len;p+=4)m[p]=0;var q=b.width,r=b.height;for(var s=0;s<r;++s)for(var t=0;t<q;++t){if(t+c>=e)break;if(t+c>=0){var p=((s+d)*e+(t+c))*4+3,u=(s*e+t)*4+3;m[p]=n[u]}}return g?(k.clearRect(0,0,e,f),k.putImageData(l,0,0),j.toDataURL()):l}